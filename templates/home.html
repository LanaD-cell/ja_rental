<!DOCTYPE html>
<html>
<head>
    <title>Calli der Camper</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"/>

    <!-- jQuery (required) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap JS (already included) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Datepicker JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

</head>
<body>
<div class="container mt-4">
  <h1>{{ van.name }}</h1>
  <p>{{ van.description }}</p>
  <p><strong>${{ van.price_per_day }}</strong> per day</p>

  <label for="rental-date">Select Rental Date:</label>
  <input id="rental-date" class="form-control" />

  <script>
    $(function() {
      // Parse booked dates passed from Django context
      const bookedDates = {{ booked_dates|safe }};

      // Create array of dates to disable
      let disabledDates = [];
      bookedDates.forEach(range => {
        let current = new Date(range.start);
        let end = new Date(range.end);
        while (current <= end) {
          disabledDates.push(new Date(current).toISOString().split('T')[0]);
          current.setDate(current.getDate() + 1);
        }
      });

      $('#rental-date').datepicker({
        format: 'yyyy-mm-dd',
        startDate: new Date(),
        datesDisabled: disabledDates,
        autoclose: true,
        todayHighlight: true,
      });
    });
  </script>
</div>

</body>
</html>
